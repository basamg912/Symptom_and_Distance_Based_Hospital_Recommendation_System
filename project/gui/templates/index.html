<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë³‘ì› ì¶”ì²œ ì‹œìŠ¤í…œ | Hospital Recommendation</title>
    <meta name="description" content="ì¦ìƒì„ ì…ë ¥í•˜ë©´ AIê°€ ìµœì ì˜ ì„±ë¶êµ¬ ë³‘ì›ì„ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤." />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>

<!-- Ambient background orbs -->
<div class="bg-orbs">
    <div class="orb"></div>
    <div class="orb"></div>
    <div class="orb"></div>
</div>

<div class="container">

    <!-- â”€â”€ Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <header class="hero">
        <div class="hero__icon">ğŸ¥</div>
        <h1>AI ë³‘ì› ì¶”ì²œ ì‹œìŠ¤í…œ</h1>
        <p>ì¦ìƒì„ ì…ë ¥í•˜ë©´ AIê°€ ì„±ë¶êµ¬ ë‚´ ìµœì ì˜ ë³‘ì›ì„ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤</p>
    </header>

    <!-- â”€â”€ Search â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section class="search-section glass" id="search-section">
        <label for="symptom-input">ì¦ìƒì„ ì…ë ¥í•˜ì„¸ìš”</label>
        <textarea
            id="symptom-input"
            placeholder="ì˜ˆ: ë¨¸ë¦¬ê°€ ì•„í”„ê³  ì–´ì§€ëŸ¬ì›Œìš” / ë°°ê°€ ì•„í”„ê³  ì†Œí™”ê°€ ì•ˆë¼ìš”..."
            rows="4"
        ></textarea>
        <button class="btn-submit" id="btn-submit" type="button">
            ğŸ” ë³‘ì› ì¶”ì²œ ë°›ê¸°
        </button>
    </section>

    <!-- â”€â”€ Error â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="error-message" id="error-message"></div>

    <!-- â”€â”€ Loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>AIê°€ ì¦ìƒì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤â€¦</p>
    </div>

    <!-- â”€â”€ Results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="dept-badge-wrap" id="dept-badge-wrap">
        <span class="label">ì¶”ì¶œ ì§„ë£Œê³¼</span>
        <span class="dept-badge" id="dept-badge"></span>
    </div>

    <h2 class="results-title" id="results-title">ì¶”ì²œ ë³‘ì›</h2>

    <div class="results-grid" id="results-grid"></div>

    <!-- â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <footer class="footer">
        Symptom &amp; Distance Based Hospital Recommendation System &mdash; Powered by Gemini &amp; SBERT
    </footer>

</div>

<script>
(function () {
    const input     = document.getElementById('symptom-input');
    const btn       = document.getElementById('btn-submit');
    const loading   = document.getElementById('loading');
    const errorDiv  = document.getElementById('error-message');
    const deptWrap  = document.getElementById('dept-badge-wrap');
    const deptBadge = document.getElementById('dept-badge');
    const resTitle  = document.getElementById('results-title');
    const resGrid   = document.getElementById('results-grid');

    function resetUI() {
        errorDiv.classList.remove('active');
        errorDiv.textContent = '';
        deptWrap.classList.remove('active');
        resTitle.classList.remove('active');
        resGrid.innerHTML = '';
    }

    function showError(msg) {
        errorDiv.textContent = msg;
        errorDiv.classList.add('active');
    }

    function formatHours(raw) {
        if (!raw || raw === 'nan') return 'ì •ë³´ ì—†ìŒ';
        // Replace commas with line breaks for readability
        return raw.replace(/,\s*/g, '\n');
    }

    function createCard(hospital, index) {
        const card = document.createElement('div');
        card.className = 'hospital-card glass';
        card.style.animationDelay = (index * 0.06) + 's';

        const phone = hospital.telephone && hospital.telephone !== 'nan'
            ? hospital.telephone : 'ì •ë³´ ì—†ìŒ';
        const hours = formatHours(hospital.opening_hours);

        card.innerHTML = `
            <span class="card-rank">#${index + 1}</span>
            <div class="card-name">${hospital.hospital_name}</div>
            <div class="card-details">
                <div class="card-detail">
                    <span class="icon">ğŸ©º</span>
                    <span class="value">${hospital.medical_subject}</span>
                </div>
                <div class="card-detail">
                    <span class="icon">ğŸ“</span>
                    <span class="value">${hospital.address}</span>
                </div>
                <div class="card-detail">
                    <span class="icon">ğŸ“</span>
                    <span class="value">${phone}</span>
                </div>
                <div class="card-detail">
                    <span class="icon">ğŸ•</span>
                    <span class="value" style="white-space:pre-line">${hours}</span>
                </div>
            </div>
        `;
        return card;
    }

    async function handleSubmit() {
        const symptom = input.value.trim();
        if (!symptom) {
            resetUI();
            showError('ì¦ìƒì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        resetUI();
        btn.disabled = true;
        loading.classList.add('active');

        try {
            const res = await fetch('/api/recommend', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ symptom }),
            });

            const data = await res.json();

            if (!res.ok) {
                showError(data.error || 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                return;
            }

            // Show extracted department
            if (data.extracted_dept) {
                deptBadge.textContent = data.extracted_dept;
                deptWrap.classList.add('active');
            }

            // Render cards
            if (data.hospitals && data.hospitals.length > 0) {
                resTitle.classList.add('active');
                data.hospitals.forEach(function (h, i) {
                    resGrid.appendChild(createCard(h, i));
                });
            } else {
                showError('ì¶”ì²œ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
        } catch (err) {
            showError('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + err.message);
        } finally {
            btn.disabled = false;
            loading.classList.remove('active');
        }
    }

    btn.addEventListener('click', handleSubmit);

    // Allow Ctrl+Enter / Cmd+Enter to submit
    input.addEventListener('keydown', function (e) {
        if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
            e.preventDefault();
            handleSubmit();
        }
    });
})();
</script>

</body>
</html>
